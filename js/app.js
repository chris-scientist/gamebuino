window.addEventListener("load",function(){function e(e){e[0].naturalWidth<=320&&e.addClass("fr-pixelart")}var t="true"==$("#is_logged").val();$('[data-toggle="tooltip"]').tooltip(),$("body").on("click",".js-prevent-default",function(e){e.preventDefault()}),$("#btn-notifications").tooltip({placement:"bottom"}),$("body").on("click",".confirm",function(e){var t="Are you sure?";$(this).attr("data-message")&&(t=$(this).attr("data-message")),confirm(t)||e.preventDefault()}),$("#menu-top").hasClass("always_small")||$(window).on("scroll",function(){$(this).scrollTop()>85?$("#menu-top").addClass("smallmenu"):$("#menu-top").removeClass("smallmenu")}),$(".dropdown.on-hover").hover(function(){$(".dropdown-toggle",this).trigger("click")}),$("body").on("click",".dropdown.on-hover .dropdown-menu",function(e){$(this).hide()}),$("body").on("click",".dropdown.on-hover > a",function(e){}),$("body").on("submit","form.loginform",function(e){e.preventDefault();var t=$(this),n=$(this).find(".btn"),o=t.attr("action");t.hasClass("submitted")||(t.addClass("submitted"),n.hide(),t.find(".spinner").show(),$.ajax({type:"POST",url:o,data:t.serialize(),dataType:"json"}).done(function(e){e.error_login?(t.removeClass("submitted"),n.show(),t.find(".spinner").hide(),$(".element").removeClass("form-error"),t.find(".element").addClass("form-error")):($("#dynamicmodal").modal("toggle"),$(location).attr("href",e.url))}).fail(function(e){t.removeClass("submitted"),n.show(),t.find(".spinner").hide(),$(".element").removeClass("form-error"),t.find(".element").addClass("form-error")}))}),$("body").on("click",".forgot-toggle",function(e){e.preventDefault(),$(".login-div").hide(),$(".forgot-div").show()}),$("body").on("click",".login_with_email_btn",function(e){e.preventDefault(),$(".email_login_ctnr").removeClass("d-none"),$(".socialite_login_ctnr").addClass("d-none")}),$("body").on("submit","form.ajax",function(e){e.preventDefault();var t=$(this),n=$(this).find(".btn"),o=t.attr("action");if(!t.hasClass("submitted")){t.addClass("submitted"),n.hide(),t.find(".spinner").show(),$(".mail-input-error").hide(),$(".form-error").removeClass("form-error");var a=new FormData(this);$.ajax({url:o,type:"POST",data:a,dataType:"json",cache:!1,contentType:!1,processData:!1}).done(function(e){$(location).attr("href",e.url)}).fail(function(e){t.removeClass("submitted"),n.show(),t.find(".spinner").hide(),$(".element").removeClass("form-error"),$(".element .error-empty").removeClass("error-label").empty(),$.each(e.responseJSON.errors,function(e,t){dotIndex=e.indexOf("."),errorFieldId="",dotIndex>-1?errorFieldId=e.substring(dotIndex+1):errorFieldId=e,$("#formelement-"+errorFieldId).addClass("form-error"),$("#formelement-"+errorFieldId).find(".error-empty").length&&$("#formelement-"+errorFieldId).find(".error-empty").addClass("error-label").html(t[0]),$("#error-"+errorFieldId).show(),$("#error-"+errorFieldId).removeClass("dnone").text(t[0]),$("#"+errorFieldId).parent().addClass("form-error")})})}}),$("body").on("click",".vote",function(e){if(e.preventDefault(),t){var n=$(this),o=$(e.target).parent(),a=n.attr("data-url"),r=n.attr("data-type"),i=n.attr("data-id");o.find(".vote").removeClass("has-voted"),$.ajax({type:"post",url:a,data:{type:r,id:i},dataType:"JSON"}).done(function(e){e.has_voted?n.addClass("has-voted"):n.removeClass("has-voted"),o.find(".nb-upvotes").html(e.nb_upvotes),o.find(".nb-downvotes").html(e.nb_downvotes)})}}),$("body").on("click",".watch",function(e){if(e.preventDefault(),t){var n,o=$(this),a=o.hasClass("watching"),r=o.attr("data-type"),i=o.attr("data-id");n=a?o.attr("data-url-unwatch"):o.attr("data-url-watch"),$.ajax({type:"post",url:n,data:{type:r,id:i},dataType:"JSON"}).done(function(e){var t,n;e.watching?(t=o.attr("data-text-watching"),n="fa-eye",o.addClass("watching")):(t=o.attr("data-text-nowatching"),n="fa-eye-slash",o.removeClass("watching")),o.tooltip("hide").attr("data-original-title",t),o.find("i").removeClass("fa-eye").removeClass("fa-eye-slash").addClass(n)})}}),$("body").on("click",".collectionable",function(e){if(e.preventDefault(),t){var n=$(this),o=n.attr("data-type"),a=n.attr("data-id"),r=n.attr("data-url");$.ajax({type:"post",url:r,data:{type:o,id:a},dataType:"JSON"}).done(function(e){n.blur(),e.added&&"full"!==e.added?(n.removeClass("btn-secondary").addClass("btn-primary").addClass("in-collection"),alertify.success(e.message_ok)):e.added&&"full"===e.added?alertify.error(e.message_ok):n.removeClass("btn-primary").addClass("btn-secondary").removeClass("in-collection")})}}),$("body").on("click",".add_to_collection a",function(e){if(e.preventDefault(),t){var n=$(this),o=n.parents(".add_to_collection"),a=n.attr("data-type"),r=n.attr("data-id"),i=n.attr("data-url");$.ajax({type:"post",url:i,data:{type:a,id:r},dataType:"JSON"}).done(function(e){n.blur(),e.added?"full"!==e.added?(o.addClass("in-collection"),alertify.success(e.message_ok)):alertify.error(e.message_ok):o.removeClass("in-collection")})}}),$(".custom-image-upload .upload-button").click(function(e){e.preventDefault(),$(".custom-image-upload #inputimage #image").trigger("click")}),$("#filter_category_id").click(function(e){e.preventDefault(),$(location).attr("href",$(this).val())}),$("#btn-notifications").click(function(e){if(t){var n=$(this).attr("data-url");$("#notifications-list").html('<li class="acenter" style="padding: 30px;"><i class="far fa-spinner fa-spin fa-2x fa-fw"></i></li>'),$.ajax({type:"POST",url:n,dataType:"json"}).done(function(e){setTimeout(function(){$("#notifications-list").html(e.view)},200)}).fail(function(e){})}});var n=document.title;!function(){if(t){var e=site_url+"/count-notifications-not-seen";$.ajax({type:"POST",url:e,dataType:"json"}).done(function(e){e.nb_notifications>0?($("#btn-notifications, .navbar-toggler, .mobile-notif").addClass("new"),$(".nb-notifications").removeClass("dnone"),$(".nb-notifications").html(e.nb_notifications),document.title="* "+n):($("#btn-notifications, .navbar-toggler, .mobile-notif").removeClass("new"),$(".nb-notifications").addClass("dnone"),$(".nb-notifications").html(""),document.title=n)}).fail(function(e){})}}(),$("#btn-notifications").on("hide.bs.dropdown",function(e){$(".nb-notifications").addClass("dnone"),$(".nb-notifications").html("")}).on("show.bs.dropdown",function(e){document.title=n}),$(".fr-view img").on("load",function(){e($(this))}).map(function(){e($(this))})}),$(document).ready(function(){function e(e){$.ajax({type:"POST",url:$(".search-bar form").attr("action"),data:{search:e},dataType:"json"}).done(function(e){setTimeout(function(){$(".search-results").html(e.view),$(".search-results").fadeIn(),$(".search-loading").hide(),$(".close-search > i").fadeIn()},200)}).fail(function(e){$(".search-loading").hide(),$(".close-search > i").fadeIn()})}$("#is_logged").val();$("body").on("click",".search-toggle",function(e){e.preventDefault(),$(".search-bar").fadeIn(),$(".search-bar input#search").focus(),$("body").css("overflow","hidden")}),$("body").on("click",".close-search, .search-fade",function(e){e.preventDefault(),$(".search-bar, .search-results").hide(),$(".top-nav .navbar-nav").fadeIn(),$("body").css("overflow","auto")});var t=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}();$("body").on("keyup",".search-bar input#search",function(n){n.preventDefault(),$(".search-loading").fadeIn(),$(".close-search > i").hide();var o=$(this).val();t(function(){e(o)},700)}),$("body").on("keydown",".search-bar input#search",function(e){13==e.keyCode&&e.preventDefault()})}),document.addEventListener("DOMContentLoaded",function(){function e(e){for(var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(n),a=new Uint8Array(o.length),r=0;r<o.length;++r)a[r]=o.charCodeAt(r);return a}function t(){navigator.serviceWorker.ready.then(function(t){return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e(a)})}).then(function(e){return o(e,"POST")}).then(function(e){return e&&changePushButtonState("enabled")}).catch(function(e){"denied"===Notification.permission?(console.warn("Notifications are denied by the user."),changePushButtonState("incompatible")):(console.error("Impossible to subscribe to push notifications",e),changePushButtonState("disabled"))})}function n(){navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(e){return e?o(e,"PUT"):void t()}).then(function(e){return e}).catch(function(e){console.error("Error when updating the subscription",e)})}function o(e,t){var n=e.getKey("p256dh"),o=e.getKey("auth"),a=(PushManager.supportedContentEncodings||["aesgcm"])[0];return $.ajax({url:r,contentType:"application/json; charset=utf-8",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:t,data:JSON.stringify({endpoint:e.endpoint,publicKey:n?btoa(String.fromCharCode.apply(null,new Uint8Array(n))):null,authToken:o?btoa(String.fromCharCode.apply(null,new Uint8Array(o))):null,contentEncoding:a})}),Promise.resolve(e)}if("true"==$("#is_logged").val()){console.log("Attempting service worker stuff");var a=document.getElementById("vapid_public_key").value,r="/push_subscription";return"serviceWorker"in navigator?"PushManager"in window?"showNotification"in ServiceWorkerRegistration.prototype?"denied"===Notification.permission?void console.warn("Notifications are denied by the user"):void navigator.serviceWorker.register("/push-notifications-serviceworker.js",{scope:"/"}).then(function(){console.log("[SW] Service worker has been registered"),n()},function(e){console.error("[SW] Service worker registration failed",e)}):void console.warn("Notifications are not supported by this browser"):void console.warn("Push notifications are not supported by this browser"):void console.warn("Service workers are not supported by this browser")}});