<!doctype html>
<html lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <title>Academy - Gamebuino</title> 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> 
  <link href="https://fonts.googleapis.com/css?family=Lato|Open+Sans:300,400,600,700,800|Roboto+Mono:300,400,700" rel="stylesheet"> 
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-LRlmVvLKVApDVGuspQFnRQJjkv0P7/YFrw84YYQtmYG4nK8c+M+NlmYDCv0rKWpG" crossorigin="anonymous"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"> 
  <link href="../css/animate.css" rel="stylesheet" type="text/css"> 
  <link href="../css/generic.css" rel="stylesheet" type="text/css"> 
  <link href="../css/jquery-ui.min.css" rel="stylesheet" type="text/css"> 
  <link href="../css/jquery-ui-timepicker-addon.css" rel="stylesheet" type="text/css"> 
  <link href="../css/alertify.core.css" rel="stylesheet" type="text/css"> 
  <link href="../css/alertify.default.css" rel="stylesheet" type="text/css"> 
  <link href="../css/select2.min.css" rel="stylesheet" type="text/css"> 
  <link href="../css/app.css" rel="stylesheet" type="text/css"> 
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script> 
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> 
  <script src="../js/jquery.cookie.js" type="text/javascript"></script> 
  <script src="../js/alertify.min.js" type="text/javascript" async></script> 
  <script src="../js/modal.js" type="text/javascript" async></script> 
  <script src="../js/popupConfirm.js" type="text/javascript" async></script> 
  <script src="../js/select2.min.js" type="text/javascript" async></script> 
  <script src="../js/imagesloaded.pkgd.min.js" type="text/javascript" async></script> 
  <script src="../js/wow.min.js" type="text/javascript" async></script> 
  <script src="../js/app.js" type="text/javascript" async></script> 
  <script id="js_highlight" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" async></script> 
  <script>js_highlight.addEventListener('load',function(){$('div.code, pre').each(function(i,block){hljs.highlightBlock(block);});});</script> 
  <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700&amp;display=swap" rel="stylesheet"> 
 </head> 
 <body> 
  <div class="topbar-container w-100 m-0"> 
   <nav class="primary-navbar"> 
    <div id="root-logo"> <a href="/gamebuino/"> <img width="233" src="../assets/gamebuino-logo-white.svg" alt="Gamebuino" class="logo-white"> </a> 
    </div> 
    <ul class="nav nav-pills"> 
     <li class="text-uppercase"> <a href="/gamebuino/academy-en/"> Home of Academy (EN)</a></li> 
    </ul> 
   </nav> 
   <div class="container" id="main-content">
    <div class="container"> 
     <div class="d-flex align-items-center"> <a href="/gamebuino/academy-en/index.html"> Academy </a> 
      <div class="ml-3 mr-3"> <i class="fal fa-angle-right"></i> 
      </div> <a href="/gamebuino/academy-en/learn-to-code-a-snake-game-with-python.html"> Snake (Python) </a> 
      <div class="ml-3 mr-3"> <i class="fal fa-angle-right"></i> 
      </div> <span> Controls and display </span> 
     </div> 
    </div> 
    <div class="row"> 
     <div class="col-md-8"> 
      <div class="d-flex justify-content-between"> 
       <div> 
        <h1> Controls and display </h1> 
        <h5> Step 3 </h5> 
       </div> 
       <div> <span class="open-modal btn btn-complete btn-secondary"> <i class="fal fa-check"></i> Step completed? </span> 
       </div> 
      </div> 
      <div class="mt-5 white-container"> 
       <div class="lesson-introduction"> 
        <p>Interception of user interactions.<br> Controlling snake movements.<br> Displaying snake on the game scene.<br> Scheduling of game engine tasks.</p> 
       </div> 
       <div class="lesson-content mt-5"> 
        <h3>Control the movement of the snake</h3> 
        <p>The player controls the snake's movements using the META directional PAD, i.e. the <code>LEFT</code>, <code>RIGHT</code>, <code>UP</code> and <code>DOWN</code> buttons:</p> 
        <div style="max-width:100%;width:524px;height:246px;margin:1.5em auto;"> 
         <img src="../assets/4-gamebuino-meta-1048x492.png" alt="Gamebuino META" style="max-width:100%"> 
        </div> 
        <p>Depending on the button the player pressed, it will be sufficient to call a <code>dirSnake()</code> function to apply a directional control to change the snake's movement.</p> 
        <div style="max-width:100%;width:254px;height:257px;margin:1.5em auto;"> 
         <img src="../assets/4-directional-controls-508x514.png" alt="Commandes directionnelles" style="max-width:100%"> 
        </div> 
        <p>This function is very simply defined:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Snake management
# ----------------------------------------------------------

def dirSnake(dx, dy):
    snake['vx'] = dx
    snake['vy'] = dy 
</code></pre> 
        <p><code>dx</code> and <code>dy</code> are directly associated with the snake velocity, since they correspond exactly to instantaneous variations in positions.</p> 
        <p>There are several ways to intercept the way the player acts on the console buttons. We will use one of them, which simply detects if the player presses a particular button. For example:</p> 
        <pre><code class="language-python">buttons.pressed(buttons.LEFT)
</code></pre> 
        <p>returns a Boolean (<code>True</code> or <code>False</code>) depending on whether the <code>LEFT</code> button is pressed or not.</p> 
        <p>The directional controls can then be easily applied as follows:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Game management
# ----------------------------------------------------------

def handleButtons():
    if buttons.pressed(buttons.LEFT):
        dirSnake(-1, 0)
    elif buttons.pressed(buttons.RIGHT):
        dirSnake(1, 0)
    elif buttons.pressed(buttons.UP):
        dirSnake(0, -1)
    elif buttons.pressed(buttons.DOWN):
        dirSnake(0, 1)
</code></pre> 
        <p><code>elif</code> is the contraction of <code>else if</code> and allows to restart the test on a new condition.</p> 
        <p>At this stage, the snake is not yet really moving... indeed, it has only been assigned a velocity. It is now necessary to implement its motion by modifying the position of its head according to the velociy that has just been applied to it:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Snake management
# ----------------------------------------------------------

def moveSnake():
    h = snake['head']
    x = snake['x'][h]
    y = snake['y'][h]
    h = (h + 1) % snake['len']
    snake['x'][h] = x + snake['vx']
    snake['y'][h] = y + snake['vy']
    snake['head'] = h
</code></pre> 
        <p>The <code>moveSnake()</code> function first retrieves the coordinates of the snake's head from the <code>snake['x']</code> and <code>snake['y']</code> lists:</p> 
        <pre><code class="language-pyhton">h = snake['head']
x = snake['x'][h]
y = snake['y'][h]
</code></pre> 
        <p>Then it advances the reading head one notch, rotating thanks to the modulo operator <code>%</code>:</p> 
        <pre><code class="language-python">h = (h + 1) % snake['len']
</code></pre> 
        <p>The new position of the snake head is then calculated and saved in the lists at the place pointed by the reading head:</p> 
        <pre><code class="language-python">snake['x'][h] = x + snake['vx']
snake['y'][h] = y + snake['vy']
</code></pre> 
        <p>Finally, the new position of the reading head is saved:</p> 
        <pre><code class="language-python">snake['head'] = h
</code></pre> 
        <h3>Display the snake on the game scene</h3> 
        <p>In the previous step, we had left it at the following definition for the <code>draw()</code> function, which is responsible for rendering the game scene:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Graphic display
# ----------------------------------------------------------

def draw():
    display.clear(COLOR_BG)
    display.setColor(COLOR_WALL)
    display.drawRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT)
</code></pre> 
        <p>We will need to define a new global variable for the snake color:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Global variables
# ----------------------------------------------------------

COLOR_SNAKE = 0xfd40
</code></pre> 
        <p>And now that the elements on the game scene are starting to multiply, we will also structure the display by creating more specialized functions:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Graphic display
# ----------------------------------------------------------

def draw():
    clearScreen()
    drawWalls()

def clearScreen():
    display.clear(COLOR_BG)

def drawWalls():
    display.setColor(COLOR_WALL)
    display.drawRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT)
</code></pre> 
        <p>We will add a new <code>drawSnake()</code> function that will display the snake on the grid. The easiest way to display the snake is to draw one by one each of its sections:</p> 
        <pre><code class="language-python">def drawSnake():
    display.setColor(COLOR_SNAKE)
    n = snake['len']
    for i in range(n):
        x = snake['x'][i]
        y = snake['y'][i]
        display.fillRect(
            OX + x * SNAKE_SIZE,
            OY + y * SNAKE_SIZE,
            SNAKE_SIZE,
            SNAKE_SIZE
        )
</code></pre> 
        <p>To do this, we simply go through the <code>snake['x']</code> and <code>snake['y']</code> lists to pick the coordinates of each section and draw a rectangle with the size of a grid cell. However, this is not the fastest way to execute this plot. We will see in the next step how to optimize it.</p> 
        <p>For now, let's add a call to this new function in our <code>draw()</code> function:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Graphic display
# ----------------------------------------------------------

def draw():
    clearScreen()
    drawWalls()
    drawSnake()
</code></pre> 
        <h3>Integration with the scheduler</h3> 
        <p>Now we have to integrate everything we've just done into the main scheduler so that the game finally starts to take shape.</p> 
        <p>To do this, we will organize the tasks to be performed according to the phases of the game. At the beginning, when the game starts, you have to reset the snake. Then, we start the game and activate the controller in charge of observing the player's behaviour by examining the buttons on the console. The display of the game scene must also be done.</p> 
        <p>To model these different phases of the game, we will define some global variables:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Global variables
# ----------------------------------------------------------

MODE_START = 0
MODE_PLAY  = 1
</code></pre> 
        <p>Then we will define a new dictionary to represent, in a way, the game engine:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Initialization
# ----------------------------------------------------------

game = {
    'mode': MODE_START
}
</code></pre> 
        <p>The game engine will therefore manage the different phases of the game.</p> 
        <p>Now, let's go back to our <code>tick()</code> function, which is responsible for applying the scheduling of the different tasks:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Game management
# ----------------------------------------------------------

def tick():
    if game['mode'] == MODE_START:
        resetSnake()
        game['mode'] = MODE_PLAY
    elif game['mode'] == MODE_PLAY:
        handleButtons()
        moveSnake()

    draw()
</code></pre> 
        <p>And let's see what it looks like:</p> 
        <div style="max-width:100%;width:320px;height:256px;margin:1.5em auto;box-shadow:0 4px 8px #0006;"> 
         <img src="../assets/4-demo-640x512.gif" alt="Démo" style="max-width:100%"> 
        </div> 
        <p>It's working pretty well, isn't it?</p> 
        <p>Well... okay, wall detection is not yet implemented... nor the fact that the snake can't turn back... because, in that case, it would bite its tail. We will deal with these cases in the next step!</p> 
        <p>Here is the complete <code>code.py</code> script, which integrates everything we have done so far:</p> 
        <pre><code class="language-python">from gamebuino_meta import waitForUpdate, display, color, buttons

# ----------------------------------------------------------
# Global variables
# ----------------------------------------------------------

SCREEN_WIDTH  = 80
SCREEN_HEIGHT = 64
SNAKE_SIZE    = 2
SNAKE_LENGTH  = 4
COLS          = (SCREEN_WIDTH  - 4) // SNAKE_SIZE
ROWS          = (SCREEN_HEIGHT - 4) // SNAKE_SIZE
OX            = (SCREEN_WIDTH  - COLS * SNAKE_SIZE) // 2
OY            = (SCREEN_HEIGHT - ROWS * SNAKE_SIZE) // 2
COLOR_BG      = 0x69c0
COLOR_WALL    = 0xed40
COLOR_SNAKE   = 0xfd40
MODE_START    = 0
MODE_PLAY     = 1

# ----------------------------------------------------------
# Game management
# ----------------------------------------------------------

def tick():
    if game['mode'] == MODE_START:
        resetSnake()
        game['mode'] = MODE_PLAY
    elif game['mode'] == MODE_PLAY:
        handleButtons()
        moveSnake()

    draw()

def handleButtons():
    if buttons.pressed(buttons.LEFT):
        dirSnake(-1, 0)
    elif buttons.pressed(buttons.RIGHT):
        dirSnake(1, 0)
    elif buttons.pressed(buttons.UP):
        dirSnake(0, -1)
    elif buttons.pressed(buttons.DOWN):
        dirSnake(0, 1)

# ----------------------------------------------------------
# Snake management
# ----------------------------------------------------------

def resetSnake():
    x = COLS // 2
    y = ROWS // 2
    snake['x'] = []
    snake['y'] = []
    for _ in range(SNAKE_LENGTH):
        snake['x'].append(x)
        snake['y'].append(y)
    snake['head'] = SNAKE_LENGTH - 1
    snake['len']  = SNAKE_LENGTH
    snake['vx'] = 0
    snake['vy'] = 0

def dirSnake(dx, dy):
    snake['vx'] = dx
    snake['vy'] = dy

def moveSnake():
    h = snake['head']
    x = snake['x'][h]
    y = snake['y'][h]
    h = (h + 1) % snake['len']
    snake['x'][h] = x + snake['vx']
    snake['y'][h] = y + snake['vy']
    snake['head'] = h

# ----------------------------------------------------------
# Graphic display
# ----------------------------------------------------------

def draw():
    clearScreen()
    drawWalls()
    drawSnake()

def clearScreen():
    display.clear(COLOR_BG)

def drawWalls():
    display.setColor(COLOR_WALL)
    display.drawRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT)

def drawSnake():
    display.setColor(COLOR_SNAKE)
    n = snake['len']
    for i in range(n):
        x = snake['x'][i]
        y = snake['y'][i]
        display.fillRect(OX + x * SNAKE_SIZE, OY + y * SNAKE_SIZE, SNAKE_SIZE, SNAKE_SIZE)

# ----------------------------------------------------------
# Initialization
# ----------------------------------------------------------

game = {
    'mode': MODE_START
}

snake = {
    'x':    [],
    'y':    [],
    'head': 0,
    'len':  0,
    'vx':   0,
    'vy':   0
}

# ----------------------------------------------------------
# Main loop
# ----------------------------------------------------------

while True:
    waitForUpdate()
    tick()
</code></pre> 
       </div> 
      </div> 
     </div> 
     <div class="col-md-4 d-none d-md-block"> 
      <ul class="workshop-summary-mini"> 
       <li class=""> <a href="/gamebuino/academy-en/overview.html" class="d-flex align-items-center  "> 
         <div class="circle">
           1 
         </div> 
         <div class="title ml-3">
           Overview 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/setting-up.html" class="d-flex align-items-center  "> 
         <div class="circle">
           2 
         </div> 
         <div class="title ml-3">
           Setting up 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/modeling.html" class="d-flex align-items-center  "> 
         <div class="circle">
           3 
         </div> 
         <div class="title ml-3">
           Modeling 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/controls-and-display.html" class="d-flex align-items-center  active  "> 
         <div class="circle">
           4 
         </div> 
         <div class="title ml-3">
           Controls and display 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/imposing-rules.html" class="d-flex align-items-center  "> 
         <div class="circle">
           5 
         </div> 
         <div class="title ml-3">
           Imposing rules 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/score-points.html" class="d-flex align-items-center  "> 
         <div class="circle">
           6 
         </div> 
         <div class="title ml-3">
           Score points 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/optimization.html" class="d-flex align-items-center  "> 
         <div class="circle">
           7 
         </div> 
         <div class="title ml-3">
           Optimization 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/finishes.html" class="d-flex align-items-center  "> 
         <div class="circle">
           8 
         </div> 
         <div class="title ml-3">
           Finishes 
         </div> </a></li> 
      </ul> 
     </div> 
    </div> 
    <div class="d-block d-md-none" style="margin-top:8rem"> 
     <h4 class="mb-4">Steps</h4> 
     <ul class="workshop-summary-mini"> 
      <li class=""> <a href="/gamebuino/academy-en/overview.html" class="d-flex align-items-center  "> 
        <div class="circle">
          1 
        </div> 
        <div class="title ml-3">
          Overview 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/setting-up.html" class="d-flex align-items-center  "> 
        <div class="circle">
          2 
        </div> 
        <div class="title ml-3">
          Setting up 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/modeling.html" class="d-flex align-items-center  "> 
        <div class="circle">
          3 
        </div> 
        <div class="title ml-3">
          Modeling 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/controls-and-display.html" class="d-flex align-items-center  active  "> 
        <div class="circle">
          4 
        </div> 
        <div class="title ml-3">
          Controls and display 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/imposing-rules.html" class="d-flex align-items-center  "> 
        <div class="circle">
          5 
        </div> 
        <div class="title ml-3">
          Imposing rules 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/score-points.html" class="d-flex align-items-center  "> 
        <div class="circle">
          6 
        </div> 
        <div class="title ml-3">
          Score points 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/optimization.html" class="d-flex align-items-center  "> 
        <div class="circle">
          7 
        </div> 
        <div class="title ml-3">
          Optimization 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/finishes.html" class="d-flex align-items-center  "> 
        <div class="circle">
          8 
        </div> 
        <div class="title ml-3">
          Finishes 
        </div> </a></li> 
     </ul> 
    </div>
   </div> 
   <footer id="footer"> 
    <div class="container"> 
     <div class="reinsurance"> 
      <div class="row align-items-center"> 
       <div class="col-sm-3"> 
        <p class="text-left"></p> 
       </div> 
       <div class="col-sm-6"> 
        <p class="text-center">Academy saved on October 8, 2020</p> 
       </div> 
       <div class="col-sm-3"> 
        <p class="text-right"></p> 
       </div> 
      </div> 
     </div> 
     <div class="row"> 
      <div class="col-sm-4 margeur-50"> 
       <ul class=""> 
        <li class="margeur-20"><h5 style="color:white;">Exported by :</h5></li> 
        <li> <a href="https://chris-scientist.github.io">chris-scientist</a></li> 
       </ul> 
      </div> 
      <div class="col-sm-4 margeur-50"> 
       <ul class=""> 
        <li class="margeur-10"> <a href="/gamebuino/why-this-website/">Why this website ?</a></li> 
        <li class="margeur-10"> <a href="/gamebuino/contact/">Contact</a></li> 
       </ul> 
      </div> 
      <div class="col-sm-4 margeur-50"> 
       <h6 class="footer-h6">Exported from official website</h6> 
      </div> 
     </div> 
    </div> 
   </footer>  
  </div>
 </body>
</html>