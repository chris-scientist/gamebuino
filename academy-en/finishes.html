<!doctype html>
<html lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <title>Finishes - Gamebuino</title> 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> 
  <link href="https://fonts.googleapis.com/css?family=Lato|Open+Sans:300,400,600,700,800|Roboto+Mono:300,400,700" rel="stylesheet"> 
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-LRlmVvLKVApDVGuspQFnRQJjkv0P7/YFrw84YYQtmYG4nK8c+M+NlmYDCv0rKWpG" crossorigin="anonymous"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"> 
  <link href="../css/animate.css" rel="stylesheet" type="text/css"> 
  <link href="../css/generic.css" rel="stylesheet" type="text/css"> 
  <link href="../css/jquery-ui.min.css" rel="stylesheet" type="text/css"> 
  <link href="../css/jquery-ui-timepicker-addon.css" rel="stylesheet" type="text/css"> 
  <link href="../css/alertify.core.css" rel="stylesheet" type="text/css"> 
  <link href="../css/alertify.default.css" rel="stylesheet" type="text/css"> 
  <link href="../css/select2.min.css" rel="stylesheet" type="text/css"> 
  <link href="../css/app.css" rel="stylesheet" type="text/css"> 
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script> 
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> 
  <script src="../js/jquery.cookie.js" type="text/javascript"></script> 
  <script src="../js/alertify.min.js" type="text/javascript" async></script> 
  <script src="../js/modal.js" type="text/javascript" async></script> 
  <script src="../js/popupConfirm.js" type="text/javascript" async></script> 
  <script src="../js/select2.min.js" type="text/javascript" async></script> 
  <script src="../js/imagesloaded.pkgd.min.js" type="text/javascript" async></script> 
  <script src="../js/wow.min.js" type="text/javascript" async></script> 
  <script src="../js/app.js" type="text/javascript" async></script> 
  <script id="js_highlight" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" async></script> 
  <script>js_highlight.addEventListener('load',function(){$('div.code, pre').each(function(i,block){hljs.highlightBlock(block);});});</script> 
  <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700&amp;display=swap" rel="stylesheet"> 
 </head> 
 <body> 
  <div class="topbar-container w-100 m-0"> 
   <nav class="primary-navbar"> 
    <div id="root-logo"> <a href="/gamebuino/"> <img width="233" src="../assets/gamebuino-logo-white.svg" alt="Gamebuino" class="logo-white"> </a> 
    </div> 
    <ul class="nav nav-pills"> 
     <li class="text-uppercase"> <a href="/gamebuino/meta-api-reference-en/"> META API Reference</a></li> 
     <li class="text-uppercase"> <a href="/gamebuino/academy-en/"> Academy (EN)</a></li> 
    </ul> 
   </nav> 
   <div class="container" id="main-content">
    <div class="container"> 
     <div class="d-flex align-items-center"> <a href="/gamebuino/academy-en/index.html"> Academy </a> 
      <div class="ml-3 mr-3"> <i class="fal fa-angle-right"></i> 
      </div> <a href="/gamebuino/academy-en/learn-to-code-a-snake-game-with-python.html"> Snake (Python) </a> 
      <div class="ml-3 mr-3"> <i class="fal fa-angle-right"></i> 
      </div> <span> Finishes </span> 
     </div> 
    </div> 
    <div class="row"> 
     <div class="col-md-8"> 
      <div class="d-flex justify-content-between"> 
       <div> 
        <h1> Finishes </h1> 
        <h5> Step 7 </h5> 
       </div> 
      </div> 
      <div class="mt-5 white-container"> 
       <div class="lesson-introduction"> 
        <p>Game ending management.<br> Time management and flashing.<br> Access to the complete game code.</p> 
       </div> 
       <div class="lesson-content mt-5"> 
        <h3>Manage the end of the game</h3> 
        <p>Here is a little demo that represents how to display things at the end of the game:</p> 
        <div style="max-width:100%;width:320px;height:256px;margin:1.5em auto;box-shadow:0 4px 8px #0006;"> 
         <img src="../assets/8-demo-end-640x512.gif" alt="Démo" style="max-width:100%"> 
        </div> 
        <p>Roughly speaking, we change the color of the walls and background, and we make the snake blink until the player presses the <code>A</code> button to restart a new game.</p> 
        <h4>Change of colours</h4> 
        <p>Let's start by managing the color change. We will define two new global variables to characterize the new colors: a background color <code>COLOR_LOST_BG</code> and a color for the plots <code>COLOR_LOST_FG</code>. To detect that the game is lost, we will also have to define a new game phase <code>MODE_LOST</code>:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Global variables
# ----------------------------------------------------------

COLOR_LOST_BG = 0x8800 # background
COLOR_LOST_FG = 0xffff # foreground
MODE_START    = 0
MODE_READY    = 1
MODE_PLAY     = 2
MODE_LOST     = 3
</code></pre> 
        <p>Then, we will modify the scheduler so that it takes into account this new phase of play:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Game management
# ----------------------------------------------------------

def tick():
    if not game['refresh']:
        clearSnakeTail()
    
    if game['mode'] == MODE_START:
        resetSnake()
        spawnApple()
        game['mode'] = MODE_READY
        game['score'] = 0
    elif game['mode'] == MODE_READY:
        game['refresh'] = False
        handleButtons()
        moveSnake()
        if snakeHasMoved():
            game['mode'] = MODE_PLAY
    elif game['mode'] == MODE_PLAY:
        handleButtons()
        moveSnake()
        if game['refresh']:
            game['refresh'] = False
        if didSnakeEatApple():
            game['score'] += 1
            game['refresh'] = True
            extendSnakeTail()
            spawnApple()
        if didSnakeBiteItsTail() or didSnakeHitTheWall():
            game['mode'] = MODE_LOST
            game['refresh'] = True
    else:
        handleButtons()

    draw()
</code></pre> 
        <p>This time, when the snake bites its tail or hits a wall, we switch to the <code>MODE_LOST</code> phase:</p> 
        <pre><code class="language-python">if didSnakeBiteItsTail() or didSnakeHitTheWall():
    game['mode'] = MODE_LOST
    game['refresh'] = True
</code></pre> 
        <p>Then we add an ultimate test that will be validated if the current phase of the game corresponds to <code>MODE_LOST</code>, since neither <code>MODE_START</code>, nor <code>MODE_READY</code>, nor <code>MODE_PLAY</code> will have validated the previous tests:</p> 
        <pre><code class="language-python">else:
    handleButtons()
</code></pre> 
        <p>This allows to give the hand to the player by giving him the possibility to restart the game by pressing a button. We will therefore add the consideration of this situation in our controller:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Game management
# ----------------------------------------------------------

def handleButtons():
    if buttons.pressed(buttons.LEFT):
        dirSnake(-1, 0)
    elif buttons.pressed(buttons.RIGHT):
        dirSnake(1, 0)
    elif buttons.pressed(buttons.UP):
        dirSnake(0, -1)
    elif buttons.pressed(buttons.DOWN):
        dirSnake(0, 1)
    elif game['mode'] == MODE_LOST and buttons.pressed(buttons.A):
        game['mode'] = MODE_START
</code></pre> 
        <p>If the player presses the <code>A</code> button while the game is in the <code>MODE_LOST</code> phase, the game is automatically restarted by simply switching back to the <code>MODE_START</code> one.</p> 
        <p>All we have to do now is modify the display functions of the game scene to apply the color change. To do this, simply modify the <code>clearScreen()</code> and <code>drawWalls()</code> functions to adapt the colors to the game phase:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Graphic display
# ----------------------------------------------------------

def clearScreen():
    color = COLOR_LOST_BG if game['mode'] == MODE_LOST else COLOR_BG
    display.clear(color)

def drawWalls():
    color = COLOR_LOST_FG if game['mode'] == MODE_LOST else COLOR_WALL
    display.setColor(color)
    display.drawRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT)
</code></pre> 
        <p>At this stage, the end of the game is marked by the change of colors of the game scene... but we still have to make the snake flash.</p> 
        <h4>Snake blinking</h4> 
        <p>The snake flashes by applying a color change as well, but alternatively, with a specific frequency. And if we want to be able to control the frequency of flashes, we need some kind of internal clock.</p> 
        <p>So, we will add a new <code>time</code> property to the game engine to take into account the time that elapses:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Initialization
# ----------------------------------------------------------

game  = {
    'mode':    MODE_START,
    'score':   0,
    'time':    0,
    'refresh': True
}
</code></pre> 
        <p>This time variable will be incremented by one unit each time it passes through the scheduler and initialized during the <code>MODE_START</code> phase:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Game management
# ----------------------------------------------------------

def tick():
    if not game['refresh']:
        clearSnakeTail()
    
    if game['mode'] == MODE_START:
        resetSnake()
        spawnApple()
        game['mode'] = MODE_READY
        game['score'] = 0
        game['time'] = 0
    elif game['mode'] == MODE_READY:
        game['refresh'] = False
        handleButtons()
        moveSnake()
        if snakeHasMoved():
            game['mode'] = MODE_PLAY
    elif game['mode'] == MODE_PLAY:
        handleButtons()
        moveSnake()
        if game['refresh']:
            game['refresh'] = False
        if didSnakeEatApple():
            game['score'] += 1
            game['refresh'] = True
            extendSnakeTail()
            spawnApple()
        if didSnakeBiteItsTail() or didSnakeHitTheWall():
            game['mode'] = MODE_LOST
            game['refresh'] = True
    else:
        handleButtons()

    draw()
    game['time'] += 1
</code></pre> 
        <p>Initialization is done during the <code>MODE_START</code> phase:</p> 
        <pre><code class="language-python">if game['mode'] == MODE_START:
    resetSnake()
    spawnApple()
    game['mode'] = MODE_READY
    game['score'] = 0
    game['time']  = 0
</code></pre> 
        <p>And the incrementation occurs just before the end of the scheduler cycle:</p> 
        <pre><code class="language-python">draw()
game['time'] += 1
</code></pre> 
        <p>Now that this time variable is in place, all that remains is to modify the snake's drawing function:</p> 
        <pre><code class="language-python"># ----------------------------------------------------------
# Graphic display
# ----------------------------------------------------------

def drawSnake():
    isTimeToBlink = game['time'] % 4 &lt; 2
    color = COLOR_LOST_FG if game['mode'] == MODE_LOST and isTimeToBlink else COLOR_SNAKE
    n = snake['len']
    for i in range(n):
        drawDot(snake['x'][i], snake['y'][i], color)
</code></pre> 
        <p>The variable <code>isTimeToBlink</code> allows you to implement the flashing:</p> 
        <pre><code class="language-python">isTimeToBlink = game['time'] % 4 &lt; 2
</code></pre> 
        <p>Here is a table of some of the values obtained by this calculation:</p> 
        <table> 
         <thead> 
          <tr> 
           <th style="text-align: center">game['time']</th> 
           <th style="text-align: center">game['time'] % 4</th> 
           <th style="text-align: center">isTimeToBlink</th> 
          </tr> 
         </thead> 
         <tbody> 
          <tr> 
           <td style="text-align: center">0</td> 
           <td style="text-align: center">0</td> 
           <td style="text-align: center"><code>True</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">1</td> 
           <td style="text-align: center">1</td> 
           <td style="text-align: center"><code>True</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">2</td> 
           <td style="text-align: center">2</td> 
           <td style="text-align: center"><code>False</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">3</td> 
           <td style="text-align: center">3</td> 
           <td style="text-align: center"><code>False</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">4</td> 
           <td style="text-align: center">0</td> 
           <td style="text-align: center"><code>True</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">5</td> 
           <td style="text-align: center">1</td> 
           <td style="text-align: center"><code>True</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">6</td> 
           <td style="text-align: center">2</td> 
           <td style="text-align: center"><code>False</code></td> 
          </tr> 
          <tr> 
           <td style="text-align: center">7</td> 
           <td style="text-align: center">3</td> 
           <td style="text-align: center"><code>False</code></td> 
          </tr> 
         </tbody> 
        </table> 
        <p>No need to go any further, since the result is cyclical of period <code>4</code> (this is the effect obtained by applying the modulo operator <code>%</code>).</p> 
        <p>Finally, we observe that the variable <code>isTimeToBlink</code> changes value every 2 cycles... and consequently, the snake flashing too.</p> 
        <p>There you go! <strong>We have reached the end of this workshop</strong>. You now know how to program a Snake game with Python. You notice that there are finally quite a few things to put in place and important notions to master. But the result is pretty cool, right?</p> 
        <div style="max-width:100%;width:320px;height:256px;margin:1.5em auto;box-shadow:0 4px 8px #0006;"> 
         <img src="../assets/8-demo-640x512.gif" alt="Démo" style="max-width:100%"> 
        </div> 
        <p>I hope you enjoyed it and that it will make you want to program other little games by yourself. Feel free to ask questions or leave a comment <span>on the page dedicated to the discussions related to this workshop</span>!</p> 
        <blockquote> 
         <p>I apologize for my approximate English... it's not my natural language, and I did what I could! I hope it didn't make the reading of this workshop too painful...</p> 
        </blockquote> 
        <p>You can get the complete code directly <span>on my GitHub</span>:</p> 
        <script src="https://gist.github.com/m1cr0lab/690f22fe8506ab7a2739dd6b40377b94.js"></script> 
        <p><a href="/gamebuino/academy-fr/partagez-votre-projet-sur-github-1.html" title="Partagez votre projet sur GitHub" class="btn btn-primary btn-lg"> Next workshop <i class="fa fa-forward"></i></a></p>
       </div> 
      </div> 
     </div> 
     <div class="col-md-4 d-none d-md-block"> 
      <ul class="workshop-summary-mini"> 
       <li class=""> <a href="/gamebuino/academy-en/overview.html" class="d-flex align-items-center  "> 
         <div class="circle">
           1 
         </div> 
         <div class="title ml-3">
           Overview 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/setting-up.html" class="d-flex align-items-center  "> 
         <div class="circle">
           2 
         </div> 
         <div class="title ml-3">
           Setting up 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/modeling.html" class="d-flex align-items-center  "> 
         <div class="circle">
           3 
         </div> 
         <div class="title ml-3">
           Modeling 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/controls-and-display.html" class="d-flex align-items-center  "> 
         <div class="circle">
           4 
         </div> 
         <div class="title ml-3">
           Controls and display 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/imposing-rules.html" class="d-flex align-items-center  "> 
         <div class="circle">
           5 
         </div> 
         <div class="title ml-3">
           Imposing rules 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/score-points.html" class="d-flex align-items-center  "> 
         <div class="circle">
           6 
         </div> 
         <div class="title ml-3">
           Score points 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/optimization.html" class="d-flex align-items-center  "> 
         <div class="circle">
           7 
         </div> 
         <div class="title ml-3">
           Optimization 
         </div> </a></li> 
       <li class=""> <a href="/gamebuino/academy-en/finishes.html" class="d-flex align-items-center  active  "> 
         <div class="circle">
           8 
         </div> 
         <div class="title ml-3">
           Finishes 
         </div> </a></li> 
      </ul> 
     </div> 
    </div> 
    <div class="d-block d-md-none" style="margin-top:8rem"> 
     <h4 class="mb-4">Steps</h4> 
     <ul class="workshop-summary-mini"> 
      <li class=""> <a href="/gamebuino/academy-en/overview.html" class="d-flex align-items-center  "> 
        <div class="circle">
          1 
        </div> 
        <div class="title ml-3">
          Overview 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/setting-up.html" class="d-flex align-items-center  "> 
        <div class="circle">
          2 
        </div> 
        <div class="title ml-3">
          Setting up 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/modeling.html" class="d-flex align-items-center  "> 
        <div class="circle">
          3 
        </div> 
        <div class="title ml-3">
          Modeling 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/controls-and-display.html" class="d-flex align-items-center  "> 
        <div class="circle">
          4 
        </div> 
        <div class="title ml-3">
          Controls and display 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/imposing-rules.html" class="d-flex align-items-center  "> 
        <div class="circle">
          5 
        </div> 
        <div class="title ml-3">
          Imposing rules 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/score-points.html" class="d-flex align-items-center  "> 
        <div class="circle">
          6 
        </div> 
        <div class="title ml-3">
          Score points 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/optimization.html" class="d-flex align-items-center  "> 
        <div class="circle">
          7 
        </div> 
        <div class="title ml-3">
          Optimization 
        </div> </a></li> 
      <li class=""> <a href="/gamebuino/academy-en/finishes.html" class="d-flex align-items-center  active  "> 
        <div class="circle">
          8 
        </div> 
        <div class="title ml-3">
          Finishes 
        </div> </a></li> 
     </ul> 
    </div>
   </div> 
   <footer id="footer"> 
    <div class="container"> 
     <div class="reinsurance"> 
      <div class="row align-items-center"> 
       <div class="col-sm-3"> 
        <p class="text-left"></p> 
       </div> 
       <div class="col-sm-6"> 
        <p class="text-center">Academy saved on October 8, 2020</p> 
       </div> 
       <div class="col-sm-3"> 
        <p class="text-right"></p> 
       </div> 
      </div> 
     </div> 
     <div class="row"> 
      <div class="col-sm-4 margeur-50"> 
       <ul class=""> 
        <li class="margeur-20"><h5 style="color:white;">Exported by :</h5></li> 
        <li> <a href="https://chris-scientist.github.io">chris-scientist</a></li> 
       </ul> 
      </div> 
      <div class="col-sm-4 margeur-50"> 
       <ul class=""> 
        <li class="margeur-10"> <a href="/gamebuino/why-this-website/">Why this website ?</a></li> 
        <li class="margeur-10"> <a href="/gamebuino/contact/">Contact</a></li> 
       </ul> 
      </div> 
      <div class="col-sm-4 margeur-50"> 
       <h6 class="footer-h6">Exported from official website</h6> 
      </div> 
     </div> 
    </div> 
   </footer>  
  </div>
 </body>
</html>